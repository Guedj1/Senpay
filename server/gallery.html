<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Galerie - Senpay</title><link rel="stylesheet" href="style.css"></head>
<body>
<nav>... same nav ...</nav>

<main class="container">
  <h1>Galerie multimédia</h1>

  <section class="container card">
    <h3>Ajouter un média</h3>
    <form id="uploadForm" enctype="multipart/form-data">
      <input type="file" id="media" name="media" accept="image/*,video/*,audio/*" required>
      <button type="submit">Uploader</button>
    </form>
    <div id="uploadResult"></div>
  </section>

  <section id="gallery" class="services">
    <!-- Les vignettes seront insérées ici -->
  </section>
</main>

<script src="/socket.io/socket.io.js"></script>
<script src="script.js"></script>
<script>
document.getElementById('uploadForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = document.getElementById('media').files[0];
  if(!f) return alert('Choisis un fichier');
  const form = new FormData();
  form.append('media', f);
  const resp = await fetch('/api/upload', { method:'POST', body: form });
  const data = await resp.json();
  if(data.ok){
    document.getElementById('uploadResult').innerText = 'Upload OK';
    addMediaCard(data.url);
  } else alert('Upload failed');
});

function addMediaCard(url){
  const gallery = document.getElementById('gallery');
  const ext = url.split('.').pop().toLowerCase();
  let el;
  if(['jpg','jpeg','png','gif','webp'].includes(ext)){
    el = document.createElement('img'); el.src = url; el.style.width='100%';
  } else if(['mp4','webm','mov'].includes(ext)){
    el = document.createElement('video'); el.controls=true; el.src=url; el.style.width='100%';
  } else if(['mp3','wav','ogg'].includes(ext)){
    el = document.createElement('audio'); el.controls=true; el.src=url; el.style.width='100%';
  } else {
    el = document.createElement('a'); el.href = url; el.innerText = 'Télécharger';
  }
  const card = document.createElement('div'); card.className='card';
  card.appendChild(el);
  gallery.prepend(card);
}
</script>
</body>
</html>
